{% load i18n django_tables2 %}
{% block extrahead %}
<script type="text/javascript">
$(document).ready(function($){
    $("input.action-select[type='checkbox']").change(function (e) {
        if ($(this).is(":checked")) { //If the checkbox is checked
            $(this).closest('td').addClass("selected");
            //Add class on checkbox checked
        } else {
            $(this).closest('td').removeClass("selected");
            //Remove class on checkbox uncheck
        }
    });
    $('#download_button').click(function(){
      var format = $('#export_actions select[name="file_format"]').val();
      var actionsSelect = $('#export_actions select[name="action"]').val();
      var rendered_href = '{% export_url "" %}';
      var dataSelect = $('tr input.action-select');
      var noSelect = $('span.no-selection');
      var arrSelected = [];
      var new_href;
        if (actionsSelect === 'export_action_select') {
          dataSelect.each(function() {
            if ($(this).is(":checked")) {
              arrSelected.push($(this).val());
            }
          });
          if (arrSelected.length > 0) {
            new_href = rendered_href + format + '&_selected_column_ids=' + arrSelected;
            noSelect.hide();
          } else {
            noSelect.show();
            return false;
          }
        } else {
            new_href = rendered_href + format;
        }
        $('#download_button').attr('href', new_href);
    });
});
</script>
{% endblock %}

<div class="actions" id="export_actions">
  {% block actions %}
    <div class="row">
    {% block actions-form %}
        <div class="col-md-3">
    {% for field in action_form %}{% if field.label %}<label>{{ field.label }} {% endif %}{{ field }}{% if field.label %}</label>{% endif %}{% endfor %}
    </div>
            {% endblock %}
    {% block actions-submit %}
        <div class="col-md-3">
    <a class="btn" title='{% translate "Run the selected action" %}' name="index" id="download_button" href='{% export_url ""%}'>{% translate "Go" %}</a>
        </div>
            {% endblock %}
    {% block actions-counter %}
        <div class="col-md-3">
    {% if actions_selection_counter %}
        <span class="action-counter" data-actions-icnt="{{ table.page.object_list|length }}">{{ selection_note }}</span>
             </div>

        {% if table.page.object_list|length != table.rows|length %}
        <div class="col-md-3">
        <span class="all hidden">{{ selection_note_all }}</span>
            </div>
        <div class="col-md-3">
        <span class="question hidden">
            <a href="#" title='{% translate "Click here to select the objects across all pages" %}'>{% blocktranslate with table.rows|length as total_count %}Select all {{ total_count }} {{ module_name }}{% endblocktranslate %}</a>
        </span>
        </div>
        <div class="col-md-3">
        <span class="clear hidden"><a href="#">{% translate "Clear selection" %}</a></span>
        </div>
        {% endif %}
    {% endif %}
        <div class="col-md-3">
    <span class="no-selection" style="display:none;">{% translate "No data selected" %}</span>
        </div>
    {% endblock %}
        </div>
  {% endblock %}
</div>